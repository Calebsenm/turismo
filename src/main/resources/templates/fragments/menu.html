<!-- fragments/menu.html -->
<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <div th:fragment="menu">
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
                <span class="fs-4">Mi App de Turismo</span>
            </a>
            <ul class="nav nav-pills align-items-center">
                <li class="nav-item"><a th:href="@{/public/home}" class="nav-link active" aria-current="page">Inicio</a></li>
                <li class="nav-item"><a th:href="@{/public/armar-paquete}" class="nav-link">Armar Paquete</a></li>
                <li class="nav-item" id="admin-menu-item" style="display:none;"><a th:href="@{/admin-panel}" class="nav-link">Panel Admin</a></li>
                <!-- Bloque vertical para usuario y logout -->
                <li class="nav-item d-flex flex-column align-items-end ms-3" style="min-width:120px;">
                    <span id="user-name" style="font-size:0.95rem; color:#555; font-weight:500; margin-bottom:2px; padding:0 6px; text-align:right;"></span>
                    <button id="logout-button" class="btn btn-danger btn-sm mt-1" style="width:100%;">Cerrar Sesión</button>
                </li>
            </ul>
        </header>
    <script>
        // Mostrar el menú de admin solo si el usuario es admin y mostrar el nombre del usuario logueado
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                try {
                    const res = await fetch('/api/usuarios/me', {
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    if (res.ok) {
                        const data = await res.json();
                        if (data.userType && data.userType.toUpperCase() === 'ADMIN') {
                            document.getElementById('admin-menu-item').style.display = '';
                        }
                        if (data.name) {
                            document.getElementById('user-name').textContent = data.name;
                        }
                    }
                } catch (e) {}
            }
        });
    </script>
    </div>
</body>
</html>
