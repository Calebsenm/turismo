<!-- fragments/menu.html -->
<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <div th:fragment="menu">
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
                <span class="fs-4">Mi App de Turismo</span>
            </a>
            <ul class="nav nav-pills">
                <li class="nav-item"><a th:href="@{/public/home}" class="nav-link active" aria-current="page">Inicio</a></li>
                <li class="nav-item"><a th:href="@{/public/armar-paquete}" class="nav-link">Armar Paquete</a></li>
                <li class="nav-item"><a th:href="@{/public/mis-paquetes}" class="nav-link">Mis Paquetes</a></li>
                <li class="nav-item" id="admin-menu-item" style="display:none;"><a th:href="@{/admin-panel}" class="nav-link">Panel Admin</a></li>
                <li class="nav-item"><span id="user-name" class="nav-link text-primary"></span></li>
                <li class="nav-item"><button id="logout-button" class="btn btn-danger ms-2">Cerrar Sesión</button></li>
            </ul>
        </header>
    <script>
        // Mostrar el menú de admin solo si el usuario es admin y mostrar el nombre del usuario logueado
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                try {
                    const res = await fetch('/api/usuarios/me', {
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    if (res.ok) {
                        const data = await res.json();
                        if (data.userType && data.userType.toUpperCase() === 'ADMIN') {
                            document.getElementById('admin-menu-item').style.display = '';
                        }
                        if (data.name) {
                            document.getElementById('user-name').textContent = data.name;
                        }
                    }
                } catch (e) {}
            }
        });
    </script>
    </div>
</body>
</html>
