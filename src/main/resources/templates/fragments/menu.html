<!-- fragments/menu.html -->
<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/menu.css}">
</head>
<body>
    <div th:fragment="menu">
        <header class="menu-header">
            <div class="menu-logo">
                <span style="font-size:1.5rem;vertical-align:middle;">&#128747;</span>
                <span class="fs-4">TravelCo</span>
            </div>
            <nav class="menu-nav">
                <ul class="nav nav-center">
                    <li class="nav-item">
                        <a th:href="@{/public/home}" class="nav-link active" aria-current="page">
                            <span style="font-size:1.2em;vertical-align:middle;">&#127968;</span> Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a th:href="@{/public/armar-paquete}" class="nav-link">
                            <span style="font-size:1.2em;vertical-align:middle;">&#128197;</span> Armar Paquete
                        </a>
                    </li>
                    <li class="nav-item" id="admin-menu-item" style="display:none;">
                        <a th:href="@{/admin-panel}" class="nav-link">
                            <span style="font-size:1.2em;vertical-align:middle;">&#128295;</span> Panel Admin
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="menu-user">
                <span id="user-name" class="nav-link text-primary"></span>
                <button id="logout-button" class="btn btn-danger ms-2">Cerrar Sesión</button>
            </div>
        </header>
        <style>
            .menu-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0.7rem 1.5rem 0.2rem 1.5rem;
                border-bottom: 1px solid #e3e3e3;
                background: #fff;
            }
            .menu-logo {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            .menu-nav {
                flex: 1;
                display: flex;
                justify-content: center;
            }
            .nav.nav-center {
                display: flex;
                gap: 2.2rem;
                margin: 0;
                padding: 0;
            }
            .menu-user {
                display: flex;
                flex-direction: column;
                align-items: flex-end;
                min-width: 120px;
            }
        </style>
    <script>
        // Mostrar el menú de admin solo si el usuario es admin y mostrar el nombre del usuario logueado
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                try {
                    const res = await fetch('/api/usuarios/me', {
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    if (res.ok) {
                        const data = await res.json();
                        if (data.userType && data.userType.toUpperCase() === 'ADMIN') {
                            document.getElementById('admin-menu-item').style.display = '';
                        }
                        if (data.name) {
                            document.getElementById('user-name').textContent = data.name;
                        }
                    }
                } catch (e) {}
            }
        });
    </script>
    </div>
</body>
</html>
